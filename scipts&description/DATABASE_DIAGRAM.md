# ç¨³äº†ï¼æ•°æ®åº“ç»“æ„ç¤ºæ„å›¾ v2.0

## æ•´ä½“æ¶æ„å›¾

```mermaid
graph TB
    subgraph "ç”¨æˆ·ç³»ç»Ÿ"
        Auth[Appwrite Auth<br/>ç”¨æˆ·è®¤è¯]
        Profile[profiles<br/>ç”¨æˆ·æ¡£æ¡ˆ]
    end
    
    subgraph "çŸ¥è¯†ä½“ç³»"
        UserKP[user_knowledge_points<br/>ç”¨æˆ·çŸ¥è¯†ç‚¹æ ‘ğŸŒ³]
        LibKP[knowledge_points_library<br/>å…¨å±€çŸ¥è¯†ç‚¹åº“]
        Question[questions<br/>é¢˜ç›®åº“]
    end
    
    subgraph "æ ¸å¿ƒä¸šåŠ¡"
        Mistake[mistake_records<br/>é”™é¢˜è®°å½•]
        Practice[practice_sessions<br/>ç»ƒä¹ ä¼šè¯]
        Answer[practice_answers<br/>ç­”é¢˜è®°å½•ğŸ“]
        Feedback[question_feedbacks<br/>é¢˜ç›®åé¦ˆğŸ’¬]
    end
    
    subgraph "ç»Ÿè®¡åˆ†æ"
        Weekly[weekly_reports<br/>å‘¨æŠ¥]
        Daily[daily_tasks<br/>æ¯æ—¥ä»»åŠ¡]
    end
    
    subgraph "å­˜å‚¨"
        MistakeImg[mistake-images<br/>é”™é¢˜å›¾ç‰‡]
        QuestionImg[question-images<br/>é¢˜ç›®å›¾ç‰‡]
    end
    
    Auth -->|userId| Profile
    Profile -->|åˆ›å»º| UserKP
    Profile -->|ç»Ÿè®¡| Mistake
    Profile -->|ç»Ÿè®¡| Practice
    
    LibKP -.å‚è€ƒ.-> UserKP
    UserKP -->|å±‚çº§å…³ç³»| UserKP
    UserKP -->|å…³è”| Mistake
    UserKP -->|å…³è”| Practice
    
    Question -->|å¼•ç”¨| Mistake
    Question -->|å¼•ç”¨| Answer
    
    Practice -->|åˆ›å»º| Answer
    Answer -->|å…³è”| Mistake
    Answer -->|æ›´æ–°| Mistake
    
    Mistake -->|ç”Ÿæˆ| Practice
    Mistake -->|èšåˆ| Weekly
    Mistake -->|ç”Ÿæˆ| Daily
    
    Practice -->|èšåˆ| Weekly
    Practice -->|å®Œæˆ| Daily
    
    Question <-->|åé¦ˆ| Feedback
    
    Mistake -.ä¸Šä¼ .-> MistakeImg
    Question -.å¼•ç”¨.-> QuestionImg
    
    style Auth fill:#e1f5ff
    style Profile fill:#e1f5ff
    style UserKP fill:#fff4e1
    style LibKP fill:#fffacd
    style Question fill:#fff4e1
    style Mistake fill:#ffe1f5
    style Practice fill:#ffe1f5
    style Answer fill:#ffd4e5
    style Feedback fill:#e5f5ff
    style Weekly fill:#e1ffe1
    style Daily fill:#e1ffe1
    style MistakeImg fill:#f0f0f0
    style QuestionImg fill:#f0f0f0
```

## æ ¸å¿ƒæ•°æ®æµ

```mermaid
sequenceDiagram
    participant U as ç”¨æˆ·
    participant UKP as user_knowledge_points
    participant M as mistake_records
    participant Q as questions
    participant P as practice_sessions
    participant A as practice_answers
    participant F as question_feedbacks
    participant W as weekly_reports
    participant D as daily_tasks
    
    Note over U,UKP: 1. æ‹ç…§è¯†åˆ«é”™é¢˜
    U->>Q: OCRè¯†åˆ«/åˆ›å»ºé¢˜ç›®
    U->>UKP: AIè¯†åˆ«/åˆ›å»ºçŸ¥è¯†ç‚¹
    U->>M: åˆ›å»ºé”™é¢˜è®°å½•
    M->>UKP: æ›´æ–°ç»Ÿè®¡(mistakeCount++)
    M->>U: è¿”å›é”™é¢˜å¡ç‰‡
    
    Note over M,P: 2. ä¸¾ä¸€åä¸‰ç»ƒä¹ 
    U->>P: åˆ›å»ºç»ƒä¹ ä¼šè¯
    U->>A: æäº¤æ¯é¢˜ç­”æ¡ˆ
    A->>P: æ›´æ–°è¿›åº¦ç»Ÿè®¡
    A->>M: æ›´æ–°æŒæ¡çŠ¶æ€
    P->>U: æ˜¾ç¤ºç»“æœå’ŒAIæ€»ç»“
    
    Note over Q,F: 3. é¢˜ç›®åé¦ˆ
    U->>F: æäº¤é¢˜ç›®é—®é¢˜åé¦ˆ
    F->>Q: æ›´æ–°qualityScore
    
    Note over M,D: 4. æ¯æ—¥ä»»åŠ¡ç”Ÿæˆ
    M->>D: åˆ†æé”™é¢˜ç”Ÿæˆä»»åŠ¡
    U->>D: å®Œæˆæ¯æ—¥ä»»åŠ¡
    D->>M: æ›´æ–°å¤ä¹ è®°å½•
    
    Note over M,W: 5. å‘¨æŠ¥ç”Ÿæˆ
    M->>W: èšåˆé”™é¢˜æ•°æ®
    P->>W: èšåˆç»ƒä¹ æ•°æ®
    W->>U: æ¨é€å‘¨æŠ¥
```

## Collection è¯¦ç»†ç»“æ„

### ç”¨æˆ·ç›¸å…³

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   profiles (ç”¨æˆ·æ¡£æ¡ˆ)        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ userId (â†’ Auth)           â”‚
â”‚ â€¢ name                      â”‚
â”‚ â€¢ grade                     â”‚
â”‚ â€¢ focusSubjects []          â”‚
â”‚ â€¢ totalMistakes             â”‚
â”‚ â€¢ masteredMistakes          â”‚
â”‚ â€¢ continuousDays            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### çŸ¥è¯†ä½“ç³»

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ knowledge_points_library (å…¨å±€åº“)    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ subject                           â”‚
â”‚ â€¢ name                              â”‚
â”‚ â€¢ parentId (è‡ªå…³è”)                 â”‚
â”‚ â€¢ level                             â”‚
â”‚ â€¢ aliases [] (åˆ«å)                 â”‚
â”‚ â€¢ usageCount (è¢«å¼•ç”¨æ¬¡æ•°)            â”‚
â”‚ â€¢ isVerified (æ˜¯å¦å®¡æ ¸)             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ (ä¾›AIè¯†åˆ«å‚è€ƒ)
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ user_knowledge_points (ç”¨æˆ·çŸ¥è¯†ç‚¹æ ‘) â”‚        â”‚   questions (é¢˜ç›®åº“)         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ userId                            â”‚        â”‚ â€¢ subject                   â”‚
â”‚ â€¢ subject                           â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”‚ â€¢ knowledgePointId          â”‚
â”‚ â€¢ name                              â”‚        â”‚ â€¢ type                      â”‚
â”‚ â€¢ parentId (è‡ªå…³è”)                 â”‚        â”‚ â€¢ difficulty                â”‚
â”‚ â€¢ level                             â”‚        â”‚ â€¢ content                   â”‚
â”‚ â€¢ mistakeCount (ç»Ÿè®¡)               â”‚        â”‚ â€¢ answer                    â”‚
â”‚ â€¢ masteredCount (ç»Ÿè®¡)              â”‚        â”‚ â€¢ explanation               â”‚
â”‚ â€¢ createdFrom (user/ai/import)      â”‚        â”‚ â€¢ source (ocr/generated)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚ â€¢ createdBy (ç”¨æˆ·ID)        â”‚
         â–²                                     â”‚ â€¢ isPublic                  â”‚
         â”‚                                     â”‚ â€¢ qualityScore              â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â€¢ feedbackCount             â”‚
            (parentId å±‚çº§å…³ç³»)                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                         â”‚
                                                         â”‚ (è´¨é‡åé¦ˆ)
                                                         â†“
                                               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                               â”‚ question_feedbacks (åé¦ˆ)    â”‚
                                               â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                                               â”‚ â€¢ questionId                â”‚
                                               â”‚ â€¢ feedbackType              â”‚
                                               â”‚ â€¢ description               â”‚
                                               â”‚ â€¢ status                    â”‚
                                               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒä¸šåŠ¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    mistake_records (é”™é¢˜è®°å½•)                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ userId                                    â”‚
â”‚ â€¢ questionId (â†’ questions)                  â”‚
â”‚ â€¢ userKnowledgePointId (â†’ user_kp)          â”‚
â”‚ â€¢ subject                                   â”‚
â”‚ â€¢ errorReason                               â”‚
â”‚ â€¢ masteryStatus                             â”‚
â”‚   â”œâ”€ notStarted                             â”‚
â”‚   â”œâ”€ practicing                             â”‚
â”‚   â””â”€ mastered                               â”‚
â”‚ â€¢ reviewCount                               â”‚
â”‚ â€¢ correctCount                              â”‚
â”‚ â€¢ originalImageUrls []                      â”‚
â”‚ â€¢ lastReviewAt                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ (ç­”é¢˜æ—¶æ›´æ–°æŒæ¡çŠ¶æ€)
         â–²
         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   practice_sessions (ç»ƒä¹ ä¼šè¯)               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ userId                                    â”‚
â”‚ â€¢ type (dailyReview/mistakeDrill...)        â”‚
â”‚ â€¢ userKnowledgePointId                      â”‚
â”‚ â€¢ title / subtitle                          â”‚
â”‚ â€¢ totalQuestions (æ€»é¢˜æ•°)                    â”‚
â”‚ â€¢ completedQuestions (å·²å®Œæˆ)                â”‚
â”‚ â€¢ correctQuestions (æ­£ç¡®æ•°)                  â”‚
â”‚ â€¢ status (in_progress/completed/abandoned)  â”‚
â”‚ â€¢ aiSummary (AIæ€»ç»“)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ (åˆ›å»ºç­”é¢˜è®°å½•)
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   practice_answers (ç­”é¢˜è®°å½•)                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ userId                                    â”‚
â”‚ â€¢ sessionId (â†’ practice_sessions)           â”‚
â”‚ â€¢ questionId (â†’ questions)                  â”‚
â”‚ â€¢ mistakeRecordId (â†’ mistake_records)       â”‚
â”‚ â€¢ userAnswer                                â”‚
â”‚ â€¢ isCorrect                                 â”‚
â”‚ â€¢ timeSpent (ç­”é¢˜ç”¨æ—¶)                       â”‚
â”‚ â€¢ answeredAt                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç»Ÿè®¡åˆ†æ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      weekly_reports (å‘¨æŠ¥)               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ userId                                â”‚
â”‚ â€¢ weekStart ~ weekEnd                   â”‚
â”‚ â€¢ totalMistakes                         â”‚
â”‚ â€¢ totalPracticeSessions                 â”‚
â”‚ â€¢ practiceCompletionRate                â”‚
â”‚ â€¢ overallAccuracy                       â”‚
â”‚ â€¢ topMistakePoints [] (JSON)            â”‚
â”‚ â€¢ errorReasonDistribution [] (JSON)     â”‚
â”‚ â€¢ aiSummary                             â”‚
â”‚ â€¢ suggestions []                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      daily_tasks (æ¯æ—¥ä»»åŠ¡)              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ userId                                â”‚
â”‚ â€¢ taskDate                              â”‚
â”‚ â€¢ questionIds [] (â†’ questions)          â”‚
â”‚ â€¢ taskType                              â”‚
â”‚ â€¢ isCompleted                           â”‚
â”‚ â€¢ completedAt                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ä¸šåŠ¡åœºæ™¯æ˜ å°„

### åœºæ™¯1ï¼šå­¦ç”Ÿæ‹ç…§é”™é¢˜

```
ç”¨æˆ·æ‹ç…§ 
  â†“
OCRè¯†åˆ« (äº‘å‡½æ•°: ocr-recognition)
  â†“
AIè¯†åˆ«çŸ¥è¯†ç‚¹ â†’ æŸ¥æ‰¾/åˆ›å»º user_knowledge_point
  â†“
åˆ›å»º/åŒ¹é… question (è®°å½• createdBy)
  â†“
åˆ›å»º mistake_record (å…³è” userKnowledgePointId)
  â†“
æ›´æ–° user_knowledge_point.mistakeCount++
  â†“
æ›´æ–° profile.totalMistakes++
```

### åœºæ™¯2ï¼šé”™é¢˜åœ°å›¾å±•ç¤º

```
æŸ¥è¯¢ user_knowledge_points (æŒ‰ userId + subject)
  â†“
æ„å»ºçŸ¥è¯†ç‚¹æ ‘å½¢ç»“æ„ (æ ¹æ® parentId)
  â†“
æŸ¥è¯¢ mistake_records ç»Ÿè®¡æ•°æ®
  â†“
è¿”å›çŸ¥è¯†ç‚¹ç»Ÿè®¡ (mistakeCount, masteredCount)
  â†“
å‰ç«¯ç»˜åˆ¶æ°”æ³¡å›¾ (æ°”æ³¡å¤§å° = mistakeCount)
```

### åœºæ™¯3ï¼šä¸¾ä¸€åä¸‰ç»ƒä¹ 

```
ç”¨æˆ·é€‰æ‹©é”™é¢˜/çŸ¥è¯†ç‚¹
  â†“
ç”Ÿæˆå˜å¼é¢˜ (äº‘å‡½æ•°: generate-variants)
  â†“
åˆ›å»º practice_session (status=in_progress)
  â†“
ç”¨æˆ·ç­”é¢˜ â†’ åˆ›å»º practice_answer
           â†’ æ›´æ–° practice_session ç»Ÿè®¡
  â†“
ç­”é¢˜å®Œæˆ â†’ practice_session.status = completed
         â†’ AIç”Ÿæˆæ€»ç»“ (aiSummary)
         â†’ æ ¹æ® practice_answers æ›´æ–° mistake_records.masteryStatus
  â†“
æ›´æ–° profile.totalPracticeSessions++
```

### åœºæ™¯3.1ï¼šé¢˜ç›®åé¦ˆ

```
ç”¨æˆ·å‘ç°é¢˜ç›®é—®é¢˜
  â†“
åˆ›å»º question_feedback (status=pending)
  â†“
ç®¡ç†å‘˜å®¡æ ¸
  â†“
å¤„ç†ï¼šä¿®æ”¹é¢˜ç›® / åˆ é™¤é¢˜ç›® / æ‹’ç»åé¦ˆ
  â†“
æ›´æ–° question.qualityScore
```

### åœºæ™¯4ï¼šæ¯æ—¥ä»»åŠ¡ç”Ÿæˆ

```
å®šæ—¶ä»»åŠ¡ (æ¯å¤©å‡Œæ™¨)
  â†“
æŸ¥è¯¢ mistake_records (æœªæŒæ¡ + éœ€å¤ä¹ )
  â†“
ç”Ÿæˆå˜å¼é¢˜ (äº‘å‡½æ•°: daily-task-gen)
  â†“
åˆ›å»º daily_task
  â†“
æ¨é€é€šçŸ¥ç»™ç”¨æˆ·
```

### åœºæ™¯5ï¼šå‘¨æŠ¥ç”Ÿæˆ

```
å®šæ—¶ä»»åŠ¡ (æ¯å‘¨æ—¥æ™š)
  â†“
èšåˆ mistake_records (æœ¬å‘¨æ•°æ®)
  â†“
èšåˆ practice_sessions (æœ¬å‘¨æ•°æ®)
  â†“
AIåˆ†æç”Ÿæˆæ€»ç»“ (äº‘å‡½æ•°: weekly-report-gen)
  â†“
åˆ›å»º weekly_report
  â†“
æ¨é€é€šçŸ¥ç»™ç”¨æˆ·
```

## ç´¢å¼•ç­–ç•¥

### é«˜é¢‘æŸ¥è¯¢ç´¢å¼•

```
user_knowledge_points:
  âœ“ userId + subject                    â†’ ç”¨æˆ·å­¦ç§‘çŸ¥è¯†ç‚¹
  âœ“ userId + parentId                   â†’ æ„å»ºçŸ¥è¯†ç‚¹æ ‘
  âœ“ userId + name                       â†’ çŸ¥è¯†ç‚¹æœç´¢
  âœ“ userId + lastMistakeAt              â†’ æœ€è¿‘é”™é¢˜æ’åº

mistake_records:
  âœ“ userId + $createdAt (DESC)          â†’ é”™é¢˜åˆ—è¡¨
  âœ“ userId + subject                    â†’ å­¦ç§‘é”™é¢˜
  âœ“ userId + userKnowledgePointId       â†’ çŸ¥è¯†ç‚¹é”™é¢˜
  âœ“ userId + masteryStatus              â†’ æŒæ¡çŠ¶æ€ç­›é€‰

practice_sessions:
  âœ“ userId + startedAt (DESC)           â†’ ç»ƒä¹ å†å²
  âœ“ userId + status                     â†’ çŠ¶æ€ç­›é€‰
  âœ“ userId + type                       â†’ ç»ƒä¹ ç±»å‹ç­›é€‰

practice_answers:
  âœ“ sessionId                           â†’ ä¼šè¯ç­”é¢˜è®°å½•
  âœ“ userId + answeredAt                 â†’ ç”¨æˆ·ç­”é¢˜å†å²
  âœ“ mistakeRecordId                     â†’ é”™é¢˜å…³è”ç­”é¢˜

question_feedbacks:
  âœ“ questionId                          â†’ é¢˜ç›®åé¦ˆåˆ—è¡¨
  âœ“ userId + $createdAt                 â†’ ç”¨æˆ·åé¦ˆå†å²
  âœ“ status                              â†’ å¾…å¤„ç†åé¦ˆ

knowledge_points_library:
  âœ“ subject + level                     â†’ åˆ†å±‚æŸ¥è¯¢
  âœ“ subject + name                      â†’ æœç´¢
  âœ“ name (fulltext)                     â†’ å…¨æ–‡æœç´¢

daily_tasks:
  âœ“ userId + taskDate (UNIQUE)          â†’ ä»Šæ—¥ä»»åŠ¡
  
weekly_reports:
  âœ“ userId + weekStart (UNIQUE)         â†’ å‘¨æŠ¥æŸ¥è¯¢
```

## æ•°æ®é‡ä¼°ç®—

### å•ç”¨æˆ·å¹´åº¦æ•°æ®ï¼ˆé¢„ä¼°ï¼‰

```
user_knowledge_points: ~30 æ¡ (é€æ­¥ç§¯ç´¯)
mistake_records:       ~500 æ¡/å¹´
practice_sessions:     ~200 æ¡/å¹´
practice_answers:      ~600 æ¡/å¹´ (å¹³å‡æ¯æ¬¡ç»ƒä¹ 3é¢˜)
question_feedbacks:    ~10 æ¡/å¹´
daily_tasks:          ~365 æ¡/å¹´
weekly_reports:        ~52 æ¡/å¹´
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
æ€»è®¡:                ~1,757 æ¡/å¹´
```

### å­˜å‚¨å®¹é‡ä¼°ç®—

```
å•æ¡é”™é¢˜è®°å½•:        ~2 KB
å•ä¸ªç»ƒä¹ ä¼šè¯:        ~1 KB (ç®€åŒ–å)
å•æ¡ç­”é¢˜è®°å½•:        ~0.5 KB
å•å¼ é”™é¢˜å›¾ç‰‡:        ~500 KB (å‹ç¼©å)

1000ä¸ªæ´»è·ƒç”¨æˆ·/å¹´:
  - æ–‡æ¡£æ•°æ®:      ~1.5 GB
  - å›¾ç‰‡æ•°æ®:      ~250 GB
```

## v2.0 æ ¸å¿ƒæ”¹è¿›

### 1. ç”¨æˆ·çŸ¥è¯†ç‚¹æ ‘ ğŸŒ³
- æ¯ä¸ªç”¨æˆ·æ‹¥æœ‰è‡ªå·±çš„çŸ¥è¯†ç‚¹æ ‘ï¼ˆ`user_knowledge_points`ï¼‰
- éšç€é”™é¢˜è®°å½•åŠ¨æ€æ„å»º
- å…¨å±€çŸ¥è¯†ç‚¹åº“ï¼ˆ`knowledge_points_library`ï¼‰ä½œä¸ºAIè¯†åˆ«å‚è€ƒ

### 2. ç»ƒä¹ ä¸ç­”é¢˜åˆ†ç¦» ğŸ“
- `practice_sessions` åªå­˜å‚¨ç»ƒä¹ ä¼šè¯å…ƒä¿¡æ¯
- `practice_answers` ç‹¬ç«‹å­˜å‚¨æ¯æ¬¡ç­”é¢˜è®°å½•
- èŒè´£æ¸…æ™°ï¼ŒæŸ¥è¯¢é«˜æ•ˆ

### 3. é¢˜ç›®åé¦ˆæœºåˆ¶ ğŸ’¬
- `question_feedbacks` æ”¶é›†ç”¨æˆ·åé¦ˆ
- å½±å“é¢˜ç›® `qualityScore`
- æ”¯æŒå®¡è®¡å’ŒæŒç»­æ”¹è¿›

---

## æ‰©å±•æ€§è®¾è®¡

### å·²å®ç°çš„æ‰©å±•æ€§

1. âœ… **ç”¨æˆ·çŸ¥è¯†ç‚¹æ ‘**ï¼šæ”¯æŒä¸ªæ€§åŒ–å­¦ä¹ è·¯å¾„
2. âœ… **ç»ƒä¹ ç­”é¢˜åˆ†ç¦»**ï¼šä¾¿äºè¯¦ç»†åˆ†æå­¦ä¹ è¡Œä¸º
3. âœ… **é¢˜ç›®åé¦ˆæœºåˆ¶**ï¼šæ”¯æŒä¼—åŒ…å®¡è®¡å’Œè´¨é‡æå‡
4. âœ… **é¢˜ç›®æ¥æºè¿½è¸ª**ï¼šæ”¯æŒOCRã€AIç”Ÿæˆã€æ‰‹åŠ¨åˆ›å»º
5. âœ… **çŸ¥è¯†ç‚¹æ¥æºæ ‡è®°**ï¼šåŒºåˆ†ç”¨æˆ·ã€AIã€å¯¼å…¥æ¥æº

### æœªæ¥å¯æ‰©å±•çš„æ–¹å‘

1. **ç­çº§åŠŸèƒ½** â†’ æ–°å¢ `classes` collection
2. **æ•™å¸ˆç«¯** â†’ æ–°å¢ `teachers` collection  
3. **æˆå°±ç³»ç»Ÿ** â†’ æ–°å¢ `achievements` collection
4. **ç¤¾äº¤åŠŸèƒ½** â†’ æ–°å¢ `follows`, `comments` collection
5. **çŸ¥è¯†ç‚¹å…±äº«** â†’ user_knowledge_points æ”¯æŒåˆ†äº«å’Œå¯¼å…¥
6. **é¢˜ç›®å¸‚åœº** â†’ questions.isPublic æ”¯æŒç”¨æˆ·è´¡çŒ®é¢˜åº“

### å…ƒæ•°æ®å­—æ®µé¢„ç•™

å¤šä¸ªè¡¨åŒ…å« `metadata` JSONå­—æ®µï¼Œå¯çµæ´»å­˜å‚¨æ‰©å±•æ•°æ®ã€‚

---

## å›¾ä¾‹è¯´æ˜

- **å®çº¿ç®­å¤´** (â†’): ç›´æ¥å¼•ç”¨å…³ç³»
- **è™šçº¿ç®­å¤´** (â‡¢): é—´æ¥å…³è”æˆ–èšåˆ
- ğŸŒ³ ç”¨æˆ·çŸ¥è¯†ç‚¹æ ‘ï¼ˆæ–°ï¼‰
- ğŸ“ ç­”é¢˜è®°å½•åˆ†ç¦»ï¼ˆæ–°ï¼‰
- ğŸ’¬ é¢˜ç›®åé¦ˆæœºåˆ¶ï¼ˆæ–°ï¼‰
- **è“è‰²**: ç”¨æˆ·ç³»ç»Ÿ
- **é»„è‰²**: çŸ¥è¯†ä½“ç³»
- **ç²‰è‰²**: æ ¸å¿ƒä¸šåŠ¡
- **ç»¿è‰²**: ç»Ÿè®¡åˆ†æ
- **ç°è‰²**: å­˜å‚¨ç³»ç»Ÿ

---

*æœ€åæ›´æ–°ï¼š2025-10-29*
*ç‰ˆæœ¬ï¼šv2.0*

