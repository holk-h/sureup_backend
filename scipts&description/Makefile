# ç¨³äº†ï¼åç«¯å¼€å‘è¾…åŠ©å‘½ä»¤

.PHONY: help setup init verify seed clean

help:
	@echo "ç¨³äº†ï¼åç«¯å¼€å‘å‘½ä»¤"
	@echo ""
	@echo "ä½¿ç”¨æ–¹æ³•: make [å‘½ä»¤]"
	@echo ""
	@echo "å¯ç”¨å‘½ä»¤:"
	@echo "  setup      - è®¾ç½®Pythonè™šæ‹Ÿç¯å¢ƒå¹¶å®‰è£…ä¾èµ–"
	@echo "  init       - åˆå§‹åŒ–Appwriteæ•°æ®åº“"
	@echo "  verify     - éªŒè¯æ•°æ®åº“é…ç½®"
	@echo "  seed       - å¯¼å…¥çŸ¥è¯†ç‚¹ç§å­æ•°æ®"
	@echo "  clean      - æ¸…ç†ä¸´æ—¶æ–‡ä»¶å’Œç¼“å­˜"
	@echo ""
	@echo "ç¤ºä¾‹:"
	@echo "  make setup   # é¦–æ¬¡è®¾ç½®ç¯å¢ƒ"
	@echo "  make init    # åˆå§‹åŒ–æ•°æ®åº“"

setup:
	@echo "ğŸ“¦ è®¾ç½®Pythonè™šæ‹Ÿç¯å¢ƒ..."
	python3 -m venv .venv
	@echo "âœ… è™šæ‹Ÿç¯å¢ƒåˆ›å»ºå®Œæˆ"
	@echo ""
	@echo "ğŸ“¥ å®‰è£…ä¾èµ–..."
	.venv/bin/pip install -r requirements.txt
	@echo "âœ… ä¾èµ–å®‰è£…å®Œæˆ"
	@echo ""
	@echo "ğŸ’¡ æç¤ºï¼š"
	@echo "   è¯·é…ç½® .env æ–‡ä»¶ï¼Œç„¶åè¿è¡Œ: make init"
	@echo "   æ¿€æ´»ç¯å¢ƒ: source .venv/bin/activate"

init:
	@echo "ğŸš€ åˆå§‹åŒ–Appwriteæ•°æ®åº“..."
	@if [ ! -f .env ]; then \
		echo "âŒ é”™è¯¯ï¼š.env æ–‡ä»¶ä¸å­˜åœ¨"; \
		echo "   è¯·ä» .env.example å¤åˆ¶å¹¶é…ç½®"; \
		exit 1; \
	fi
	@. .venv/bin/activate && set -a && . .env && set +a && python init_database.py

verify:
	@echo "ğŸ” éªŒè¯æ•°æ®åº“é…ç½®..."
	@. .venv/bin/activate && set -a && . .env && set +a && python verify_database.py

verify-detail:
	@echo "ğŸ” éªŒè¯æ•°æ®åº“é…ç½®ï¼ˆè¯¦ç»†æ¨¡å¼ï¼‰..."
	@. .venv/bin/activate && set -a && . .env && set +a && python verify_database.py --details

seed:
	@echo "ğŸŒ± å¯¼å…¥çŸ¥è¯†ç‚¹ç§å­æ•°æ®..."
	@. .venv/bin/activate && set -a && . .env && set +a && python seed_knowledge_points.py

clean:
	@echo "ğŸ§¹ æ¸…ç†ä¸´æ—¶æ–‡ä»¶..."
	find . -type d -name "__pycache__" -exec rm -rf {} + 2>/dev/null || true
	find . -type f -name "*.pyc" -delete
	find . -type f -name "*.pyo" -delete
	find . -type f -name "*.log" -delete
	@echo "âœ… æ¸…ç†å®Œæˆ"

clean-all: clean
	@echo "ğŸ—‘ï¸  åˆ é™¤è™šæ‹Ÿç¯å¢ƒ..."
	rm -rf .venv
	@echo "âœ… å®Œå…¨æ¸…ç†å®Œæˆ"

